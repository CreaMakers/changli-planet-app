name: Reusable Send Notification

on:
  workflow_call:
    inputs:
      build_status:
        required: true
        type: string
      obs_url:
        required: false
        type: string
        description: "OBS download URL for the APK file"
    secrets:
      WEBHOOK_API_KEY:
        required: true
      WEBHOOK_ADDRESS:
        required: true

jobs:
  send-notification:
    name: Send Notification
    runs-on: ubuntu-latest
    steps:
      - name: Send Notification
        run: |
          STATUS_MESSAGE="âŒ æ„å»ºå¤±è´¥"
          if [[ ${{ inputs.build_status }} == 'success' ]]; then
            STATUS_MESSAGE="âœ… æ„å»ºæˆåŠŸ"
          fi
          
          # æ„å»ºåŸºç¡€æ¶ˆæ¯
          MESSAGE="$STATUS_MESSAGE\n\nä»“åº“ï¼š${{ github.repository }}\nå·¥ä½œæµï¼š${{ github.workflow }}\nåœ°å€ï¼š${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          
          # å¦‚æœæœ‰OBSä¸‹è½½é“¾æ¥ï¼Œæ·»åŠ åˆ°æ¶ˆæ¯ä¸­
          if [[ -n "${{ inputs.obs_url }}" && "${{ inputs.obs_url }}" != "" ]]; then
            MESSAGE="$MESSAGE\n\nğŸ“± APKä¸‹è½½ï¼š${{ inputs.obs_url }}"
          fi
          
          JSON_STRING="{\"message\":\"$MESSAGE\"}"
          curl -X POST \
          -H "Content-Type: application/json" \
          -d "$JSON_STRING" \
          "https://webhook.zhelearn.com/webhook/custom/${{ secrets.WEBHOOK_API_KEY }}?chat_type=group&chat_number=${{ secrets.WEBHOOK_ADDRESS }}"
